import{ssr as h,ssrHydrationKey as y,isServer as B,getRequestEvent as M,createComponent as p,ssrElement as S,escape as g,mergeProps as U,useAssets as z,NoHydration as I,HydrationScript as K,ssrAttribute as G,Hydration as J,renderToStream as Y}from"solid-js/web";import{onCleanup as Q,ErrorBoundary as V,lazy as X,createComponent as Z,sharedConfig as b}from"solid-js";import{provideRequestEvent as ee}from"solid-js/web/storage";import{H3Event as C,setResponseStatus as te,sendRedirect as ne,getCookie as re,setCookie as se,setHeader as oe,getRequestURL as ae,getRequestIP as ie,getResponseStatus as le,getResponseStatusText as ce,getResponseHeaders as ue,getResponseHeader as de,setResponseHeader as pe,appendResponseHeader as fe,getRequestWebStream as he,removeResponseHeader as me,eventHandler as ge}from"h3";import{AsyncLocalStorage as ye}from"node:async_hooks";var Re=["<main","><h1>Hello Solid!</h1></main>"];function Se(){return h(Re,y())}function ve(e){if(B){const t=M();t.response.status=e.code,t.response.statusText=e.text,Q(()=>!t.nativeEvent.handled&&(t.response.status=200))}return null}function we(e){return p(V,{get fallback(){return p(ve,{code:500})},get children(){return e.children}})}var Ce=" ";const $e={style:e=>S("style",e.attrs,()=>g(e.children),!0),link:e=>S("link",e.attrs,void 0,!0),script:e=>e.attrs.src?S("script",U(()=>e.attrs,{get id(){return e.key}}),()=>h(Ce),!0):null};function $(e){let{tag:t,attrs:{key:n,...r}={key:void 0},children:o}=e;return $e[t]({attrs:r,key:n,children:o})}var Ae=["<script",">","<\/script>"],Ee=["<script",' type="module" async',"><\/script>"];const Te=h("<!DOCTYPE html>");function O(e,t,n=[]){for(let r=0;r<t.length;r++){const o=t[r];if(o.path!==e[0].path)continue;let a=[...n,o];if(o.children){const s=e.slice(1);if(s.length===0||(a=O(s,o.children,a),!a))continue}return a}}function be(e){const t=M();let n=[];return Promise.resolve().then(async()=>{if(t.router&&t.router.matches){const r=[...t.router.matches];for(;r.length&&(!r[0].info||!r[0].info.filesystem);)r.shift();const o=r.length&&O(r,t.routes);if(o)for(let a=0;a<o.length;a++){const s=o[a],l=await globalThis.MANIFEST.client.inputs[s.$component.src].assets();n.push.apply(n,l)}else console.warn("No route matched for preloading js assets")}n=[...new Map(n.map(r=>[r.attrs.key,r])).values()].filter(r=>r.attrs.rel==="modulepreload"&&!t.assets.find(o=>o.attrs.key===r.attrs.key))}),z(()=>n.length?n.map(r=>$(r)):void 0),p(I,{get children(){return[Te,p(e.document,{get assets(){return[p(K,{}),t.assets.map(r=>$(r))]},get scripts(){return[h(Ae,y(),`window.manifest = ${JSON.stringify(t.manifest)}`),h(Ee,y(),G("src",g(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return p(J,{get children(){return p(we,{get children(){return p(Se,{})}})}})}})]}})}function Ne(e={}){let t,n=!1;const r=s=>{if(t&&t!==s)throw new Error("Context conflict")};let o;if(e.asyncContext){const s=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;s?o=new s:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const a=()=>{if(o&&t===void 0){const s=o.getStore();if(s!==void 0)return s}return t};return{use:()=>{const s=a();if(s===void 0)throw new Error("Context is not available");return s},tryUse:()=>a(),set:(s,i)=>{i||r(s),t=s,n=!0},unset:()=>{t=void 0,n=!1},call:(s,i)=>{r(s),t=s;try{return o?o.run(s,i):i()}finally{n||(t=void 0)}},async callAsync(s,i){t=s;const l=()=>{t=s},c=()=>t===s?l:void 0;_.add(c);try{const d=o?o.run(s,i):i();return n||(t=void 0),await d}finally{_.delete(c)}}}}function He(e={}){const t={};return{get(n,r={}){return t[n]||(t[n]=Ne({...e,...r})),t[n],t[n]}}}const R=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},N="__unctx__",_e=R[N]||(R[N]=He()),qe=(e,t={})=>_e.get(e,t),H="__unctx_async_handlers__",_=R[H]||(R[H]=new Set);function xe(e){let t;const n=D(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(n,{...r,body:e.node.req.body}):new Request(n,{...r,get body(){return t||(t=Ue(e),t)}})}function Le(e){return e.web??={request:xe(e),url:D(e)},e.web.request}function Pe(){return Ge()}const E=Symbol("$HTTPEvent");function ke(e){return typeof e=="object"&&(e instanceof C||e?.[E]instanceof C||e?.__is_event__===!0)}function u(e){return function(...t){let n=t[0];if(ke(n))t[0]=n instanceof C||n.__is_event__?n:n[E];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(n=Pe(),!n)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(n)}return e(...t)}}const D=u(ae),Me=u(ie),A=u(te),q=u(le),Ie=u(ce),v=u(ue),x=u(de),Oe=u(pe),De=u(fe),Fe=u(ne),We=u(re),je=u(se),Be=u(oe),Ue=u(he),ze=u(me);function Ke(){return qe("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:ye})}function Ge(){return Ke().use().event}const m={NORMAL:0,WILDCARD:1,PLACEHOLDER:2};function Je(e={}){const t={options:e,rootNode:F(),staticRoutesMap:{}},n=r=>e.strictTrailingSlash?r:r.replace(/\/$/,"")||"/";if(e.routes)for(const r in e.routes)L(t,n(r),e.routes[r]);return{ctx:t,lookup:r=>Ye(t,n(r)),insert:(r,o)=>L(t,n(r),o),remove:r=>Qe(t,n(r))}}function Ye(e,t){const n=e.staticRoutesMap[t];if(n)return n.data;const r=t.split("/"),o={};let a=!1,s=null,i=e.rootNode,l=null;for(let c=0;c<r.length;c++){const d=r[c];i.wildcardChildNode!==null&&(s=i.wildcardChildNode,l=r.slice(c).join("/"));const f=i.children.get(d);if(f!==void 0)i=f;else if(i=i.placeholderChildNode,i!==null)o[i.paramName]=d,a=!0;else break}return(i===null||i.data===null)&&s!==null&&(i=s,o[i.paramName||"_"]=l,a=!0),i?a?{...i.data,params:a?o:void 0}:i.data:null}function L(e,t,n){let r=!0;const o=t.split("/");let a=e.rootNode,s=0;for(const i of o){let l;if(l=a.children.get(i))a=l;else{const c=Ve(i);l=F({type:c,parent:a}),a.children.set(i,l),c===m.PLACEHOLDER?(l.paramName=i==="*"?`_${s++}`:i.slice(1),a.placeholderChildNode=l,r=!1):c===m.WILDCARD&&(a.wildcardChildNode=l,l.paramName=i.slice(3)||"_",r=!1),a=l}}return a.data=n,r===!0&&(e.staticRoutesMap[t]=a),a}function Qe(e,t){let n=!1;const r=t.split("/");let o=e.rootNode;for(const a of r)if(o=o.children.get(a),!o)return n;if(o.data){const a=r[r.length-1];if(o.data=null,Object.keys(o.children).length===0){const s=o.parent;s.children.delete(a),s.wildcardChildNode=null,s.placeholderChildNode=null}n=!0}return n}function F(e={}){return{type:e.type||m.NORMAL,parent:e.parent||null,children:new Map,data:e.data||null,paramName:e.paramName||null,wildcardChildNode:null,placeholderChildNode:null}}function Ve(e){return e.startsWith("**")?m.WILDCARD:e[0]===":"||e==="*"?m.PLACEHOLDER:m.NORMAL}const W=[],Xe=Ze(W.filter(e=>e.$component));function Ze(e){function t(n,r,o,a){const s=Object.values(n).find(i=>o.startsWith(i.id+"/"));return s?(t(s.children||(s.children=[]),r,o.slice(s.id.length)),n):(n.push({...r,id:o,path:o.replace(/\/\([^)/]+\)/g,"")}),n)}return e.sort((n,r)=>n.path.length-r.path.length).reduce((n,r)=>t(n,r,r.path,r.path),[])}function et(e,t){const n=nt.lookup(e);if(n){const r=n.route[`$${t}`];return r===void 0?void 0:{handler:r,params:n.params}}}function tt(e){return e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}const nt=Je({routes:W.reduce((e,t)=>{if(!tt(t))return e;let n=t.path.replace(/\(.*\)\/?/g,"").replace(/\*([^/]*)/g,(r,o)=>`**:${o}`);if(/:[^/]*\?/g.test(n))throw new Error(`Optional parameters are not supported in API routes: ${n}`);if(e[n])throw new Error(`Duplicate API routes for "${n}" found at "${e[n].route.path}" and "${t.path}"`);return e[n]={route:t},e},{})}),w=Symbol("fetchEvent");function rt(e){return{request:Le(e),response:at(e),clientAddress:Me(e),locals:{},nativeEvent:e,[E]:e}}function st(e){if(!e[w]){const t=rt(e);e[w]=t}return e[w]}class ot{constructor(t){this.event=t}get(t){const n=x(this.event,t);return Array.isArray(n)?n.join(", "):n}has(t){return this.get(t)!==void 0}set(t,n){return Oe(this.event,t,n)}delete(t){return ze(this.event,t)}append(t,n){De(this.event,t,n)}getSetCookie(){const t=x(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return this.entries().forEach(([n,r])=>t(r,n,this))}entries(){return v(this.event).map(([t,n])=>[t,Array.isArray(n)?n.join(", "):n])}keys(){return v(this.event).map(([t])=>t)}values(){return v(this.event).map(([t,n])=>Array.isArray(n)?n.join(", "):n)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function at(e){return{get status(){return q(e)},set status(t){A(e,t)},get statusText(){return Ie(e)},set statusText(t){A(e,q(),t)},headers:new ot(e)}}function it(e){e.forEach(t=>{if(!t.attrs.href)return;let n=document.head.querySelector(`link[href="${t.attrs.href}"]`);n||(n=document.createElement("link"),n.setAttribute("rel","preload"),n.setAttribute("as","style"),n.setAttribute("href",t.attrs.href),document.head.appendChild(n))})}function lt(e,t,n,r="default"){return X(async()=>{{const a=(await e.import())[r],i=(await t.inputs?.[e.src].assets()).filter(c=>c.tag==="style"||c.attrs.rel==="stylesheet");return typeof window<"u"&&it(i),{default:c=>[...i.map(d=>$(d)),Z(a,c)]}}})}function ct(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,info:{...n.$$route?n.$$route.require().route.info:{},filesystem:!0},component:lt(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return Xe.map(e)}function ut(e){const t=We(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const r=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return je(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:r}}async function j(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Cache-Control","no-cache"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],router:{submission:ut(e)},routes:ct(),$islands:new Set})}function dt(e,t={}){return ge({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const r=st(n);return ee(r,async()=>{const o=et(new URL(r.request.url).pathname,r.request.method);if(o){const f=(await o.handler.import())[r.request.method];r.params=o.params,b.context={event:r};const T=await f(r);if(T!==void 0)return T;if(r.request.method!=="GET")throw new Error(`API handler for ${r.request.method} "${r.request.url}" did not return a response.`)}const a=await j(r);let s={...t};if(s.onCompleteAll){const d=s.onCompleteAll;s.onCompleteAll=f=>{k(a)(f),d(f)}}else s.onCompleteAll=k(a);if(s.onCompleteShell){const d=s.onCompleteShell;s.onCompleteShell=f=>{P(a,n)(),d(f)}}else s.onCompleteShell=P(a,n);const i=Y(()=>(b.context.event=a,e(a)),s);if(a.response&&a.response.headers.get("Location"))return Fe(r,a.response.headers.get("Location"));const{writable:l,readable:c}=new TransformStream;return i.pipeTo(l),c})}})}function P(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(A(t,302),Be(t,"Location",e.response.headers.get("Location")))}}function k(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function pt(e,t={}){return dt(e,{...t,createPageEvent:j})}var ft=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],ht=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const vt=pt(()=>p(be,{document:({assets:e,children:t,scripts:n})=>h(ht,y(),p(I,{get children(){return h(ft,g(e))}}),g(t),g(n))}));export{vt as default};
